<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>moochip raphael demo</title>
        
		<script type="text/javascript" src="browser-detect.js"></script>
        <script type="text/javascript" src="raphael.js"></script>
        <script type="text/javascript" src="moochip-raphael.js"></script>
        <script type="text/javascript" src="moochip-stdlib-raphael.js"></script>
				
		<script type="text/javascript">
		window.onload = function () {
			var browser = BrowserDetect.browser;
			
			if (browser == 'Explorer') {
				alert('Your browser is not supported yet!');
				return;
			}
			
			var R = Raphael('holder');
			
			MooChip.paper = R;
			MooChip.scheme = new Scheme();
		};
		
		function add(type) {
			var generateName = function(type) {
				var prefixes = { 'resistor': 'r', 'diode': 'vd', 'wire': '-', 'dc_source': 'src'}, components = MooChip.scheme.components, cnt = 1;
				
				for (var i = 0; i < components.length; i++) {
					if (components[i].type == type) {
						cnt++;
					}
				}
				
				return prefixes[type] + cnt;
			};
			
			if (type == 'resistor') {
				var a = new Resistor(generateName(type), 1.0);
				MooChip.scheme.add(a);
			} else
			if (type == 'diode') {
				var a = new Diode(generateName(type));
				MooChip.scheme.add(a);
			} else
			if (type == 'dc_source') {
				var a = new DCSource(generateName(type), 5.0, 1.0);
				MooChip.scheme.add(a);
			} else
			if (type == 'wire') {
				var a = new Wire(generateName(type));
				MooChip.scheme.add(a);
			}
		}
		
		function rotate_selected() {
			if (MooChip.scheme.selectedComponent)
				MooChip.scheme.selectedComponent.rotate(90);
		}
		
		function remove_selected() {
			if (MooChip.scheme.selectedComponent)
				MooChip.scheme.remove(MooChip.scheme.selectedComponent);
		}
		
		function reset_scheme() {
			MooChip.scheme.resetComponentStates();
		}
		
		function simple_step() {
			MooChip.scheme.singleStep();
		}
		
		function full_step() {
			MooChip.scheme.fullCircuitStep();
		}
        </script>
    </head>
	
    <body>
		<div class="menu">
			<a href="#" onclick="add('resistor')" title="create a new resistor">resistor</a>
			<a href="#" onclick="add('diode')" title="create a new diode">diode</a>
			<a href="#" onclick="add('dc_source')" title="create a new DC source">DC source</a>
			<a href="#" onclick="add('wire')" title="create a new wire">wire</a>
			&nbsp;|&nbsp;
			<a href="#" onclick="rotate_selected()" title="rotate selected component 90&deg; clockwise">rotate</a>
			<a href="#" onclick="remove_selected()" title="remove selected component">remove</a>
			&nbsp;|&nbsp;
			<a href="#" onclick="reset_scheme()" title="stop any executions and reset components' states">reset</a>
			<a href="#" onclick="simple_step()" title="step execution one component along">simple step</a>
			<a href="#" onclick="full_step()" title="step execution all components at once">full step</a>
		</div>
		
        <div id="holder"></div>
    </body>
</html>